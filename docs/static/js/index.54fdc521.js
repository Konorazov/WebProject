(()=>{"use strict";var e={660:function(e,r,s){var t=s(893),a=s(294),n=s(745),o=s(661);let l="inputBox-CMYAs7";var i=s(430);let c="http://localhost:5000/",d=async e=>{try{return(await i.Z.post(`${c}/api/auth/login`,e)).data}catch(e){console.error(e)}},u=()=>{let[e,r]=(0,a.useState)(""),[s,n]=(0,a.useState)(""),i=(0,o.s0)(),c=async r=>{r.preventDefault();try{let r=await d({login:e,password:s});localStorage.userId=r.user.id,r&&i("/")}catch(e){console.error(e)}};return(0,t.jsx)("div",{className:"layout-F34GTA",children:(0,t.jsxs)("main",{className:"loginContainer-P7QzaK",children:[(0,t.jsxs)("div",{className:l,children:[(0,t.jsx)("label",{children:"Login"}),(0,t.jsx)("input",{value:e,onChange:e=>r(e.target.value)})]}),(0,t.jsxs)("div",{className:l,children:[(0,t.jsx)("label",{children:"Password"}),(0,t.jsx)("input",{type:"password",value:s,onChange:e=>n(e.target.value)})]}),(0,t.jsx)("button",{onClick:e=>c(e),children:"login"})]})})},m=()=>(0,t.jsx)("div",{className:"layout-hsPeb7",children:(0,t.jsx)(u,{})}),h="inputBox-O6uP5N",g=async e=>{try{return(await i.Z.post(`${c}/api/auth/register`,e)).data}catch(e){console.error(e)}},p=()=>{let[e,r]=(0,a.useState)(""),[s,n]=(0,a.useState)(""),[l,i]=(0,a.useState)(""),c=(0,o.s0)(),d=async r=>{if(r.preventDefault(),s!=l)return void alert("Пароли должны совподать");try{let r=await g({login:e,password:s});localStorage.userId=r.user.id,c("/")}catch(e){console.error(e)}};return(0,t.jsx)("div",{className:"layout-Ony6tL",children:(0,t.jsxs)("main",{className:"loginContainer-sLFxUd",children:[(0,t.jsxs)("div",{className:h,children:[(0,t.jsx)("label",{children:"Login"}),(0,t.jsx)("input",{value:e,onChange:e=>r(e.target.value)})]}),(0,t.jsxs)("div",{className:h,children:[(0,t.jsx)("label",{children:"Password"}),(0,t.jsx)("input",{type:"password",value:s,onChange:e=>n(e.target.value)})]}),(0,t.jsxs)("div",{className:h,children:[(0,t.jsx)("label",{children:"Confirm Password"}),(0,t.jsx)("input",{type:"password",value:l,onChange:e=>i(e.target.value)})]}),(0,t.jsx)("button",{onClick:e=>d(e),children:"login"})]})})},j=()=>(0,t.jsx)("div",{className:"layout-fRKMrx",children:(0,t.jsx)(p,{})}),x={layout:"layout-l_tuZ2",header:"header-oFCnsI",chatPartnerNameHeader:"chatPartnerNameHeader-_aKvym",main:"main-olZ8Et",noMessages:"noMessages-ID3jiJ",messageWrapper:"messageWrapper-ZoANKA",sent:"sent-puWsoE",messageBubble:"messageBubble-u5Udwu",received:"received-fSpuaW",messageContent:"messageContent-dctvo_",messageTimestamp:"messageTimestamp-tTL4iJ",footer:"footer-loJU08",messageInput:"messageInput-KQONFG",sendButton:"sendButton-aGHZ8Y",messageForm:"messageForm-ut2zIU"};var v=s(798);let f=async e=>{try{return(await i.Z.get(`${c}/api/messages/history/${e.sender_id}/${e.recipient_id}`)).data}catch(e){console.error(e)}},y=async e=>{try{return(await i.Z.get(`${c}/api/user/${e}`)).data}catch(e){console.error(e)}},N=e=>{let{currentUserId:r,chatPartnerId:s,chatPartnerName:n=`User ${s}`}=e,[o,l]=(0,a.useState)(null),[i,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(null),[h,g]=(0,a.useState)(""),[p,j]=(0,a.useState)([]),y=(0,a.useRef)(null),N=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!r||!s)return void j([]);(async()=>{try{let e=await f({sender_id:r,recipient_id:s});j(Array.isArray(e)?e:[])}catch(e){console.error("Error fetching messages:",e),j([])}})()},[r,s]),(0,a.useEffect)(()=>{if(!r)return;let e=(0,v.io)(c,{});return l(e),m(null),d(!1),e.on("connect",()=>{console.log("Socket connected:",e.id,". Attempting to join chat for user",r),e.emit("join_chat",{user_id:r.toString()})}),e.on("disconnect",e=>{console.log("Socket disconnected:",e),d(!1),m(`Disconnected: ${e}.`)}),e.on("connect_error",e=>{console.error("Socket connection error:",e),d(!1),m(`Connection Error: ${e.message}`)}),e.on("joined_chat_ack",e=>{"success"===e.status&&e.user_id===r?(console.log("Successfully joined chat as user:",e.user_id),d(!0),m(null)):(console.error("Failed to join chat or user_id mismatch:",e),d(!1),m(e.message||"Failed to join chat: acknowledgment error."))}),e.on("join_chat_error",e=>{console.error("Join chat error from server:",e.message),d(!1),m(`Join chat error: ${e.message}`)}),e.on("receive_personal_message",e=>{console.log("Received message via socket:",e);let t=e.sender_id===s&&e.recipient_id===r,a=e.sender_id===r&&e.recipient_id===s;(t||a)&&j(r=>r.find(r=>r.id===e.id)?r:[...r,e])}),e.on("message_error",e=>{console.error("Message sending error from server:",e.error),m(`Message error: ${e.error}`)}),()=>{e&&(console.log("Disconnecting socket on unmount or re-render"),e.disconnect()),d(!1)}},[r,s]);let b=e=>new Date(e).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return(0,a.useEffect)(()=>{if(p.length>0){var e;null==(e=y.current)||e.scrollIntoView({behavior:"smooth"})}},[p]),(0,t.jsxs)("div",{className:x.layout,children:[(0,t.jsxs)("header",{className:x.header,children:[(0,t.jsx)("p",{className:x.chatPartnerNameHeader,children:n}),(0,t.jsx)("span",{style:{marginLeft:"auto",fontSize:"0.8em",color:i?"green":"orange"},children:i?"Chat Joined":o&&o.connected?"Connecting to chat...":"Socket Disconnected"})]}),(0,t.jsxs)("main",{className:x.main,children:[u&&(0,t.jsx)("p",{className:x.socketError,children:u}),0===p.length&&!u&&(0,t.jsx)("p",{className:x.noMessages,children:"No messages yet."}),p.map(e=>(0,t.jsx)("div",{className:`${x.messageWrapper} ${e.sender_id===r?x.sent:x.received}`,children:(0,t.jsxs)("div",{className:x.messageBubble,children:[(0,t.jsx)("p",{className:x.messageContent,children:e.content}),(0,t.jsx)("span",{className:x.messageTimestamp,children:b(e.timestamp)})]})},e.id)),(0,t.jsx)("div",{ref:y})]}),(0,t.jsx)("footer",{className:x.footer,children:(0,t.jsxs)("form",{onSubmit:e=>{var r;if(e.preventDefault(),!o||!i||!h.trim())return void(!i&&o?m("You must join the chat first to send messages."):o||m("Not connected to chat server."));let t={recipient_id:s.toString(),content:h.trim()};o.emit("send_personal_message",t),console.log("Sent message via socket:",t),g(""),null==(r=N.current)||r.focus(),m(null)},className:x.messageForm,children:[(0,t.jsx)("input",{ref:N,type:"text",placeholder:"Type a message...",className:x.messageInput,value:h,onChange:e=>g(e.target.value),disabled:!i}),(0,t.jsx)("button",{type:"submit",className:x.sendButton,disabled:!h.trim()||!i,children:"Send"})]})})]})},b=e=>{let{onSelectPartner:r}=e,[s,n]=(0,a.useState)(""),o=async e=>{if(e.preventDefault(),!s.trim())return;let t=localStorage.userId,a=parseInt(s,10);if(isNaN(t)||isNaN(a)||t===a)return;let n=await y(a);r(a,n.login)};return(0,t.jsxs)("div",{className:"selectionContainer-l75AC4",children:[(0,t.jsx)("h1",{children:"Select Chat Partner"}),(0,t.jsxs)("form",{onSubmit:o,className:"form-_q8w4Q",children:[(0,t.jsxs)("div",{className:"inputGroup-D4MJru",children:[(0,t.jsx)("label",{htmlFor:"partnerId",children:"Chat with User ID:"}),(0,t.jsx)("input",{id:"partnerId",type:"text",value:s,onChange:e=>n(e.target.value),placeholder:"Enter partner's User ID",required:!0})]}),(0,t.jsx)("button",{type:"submit",className:"startButton-Fv0XUE",children:"Start Chat"})]})]})},S=()=>{let[e,r]=(0,a.useState)(null),[s,n]=(0,a.useState)(null),[o,l]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{let e=localStorage.getItem("userId");if(e)try{let s=parseInt(e,10);isNaN(s)?console.error("Stored User ID is not a valid number."):r(s)}catch(e){console.error("Error parsing stored User ID:",e)}l(!1)},[]),o)?(0,t.jsx)("div",{className:"loading-app",children:"Loading user data..."}):s&&e?(0,t.jsxs)("div",{className:"chat-view-container",children:[(0,t.jsx)("button",{onClick:()=>{n(null)},className:"back-button",children:"← Change Chat Partner"}),(0,t.jsx)(N,{currentUserId:e,chatPartnerId:s.id,chatPartnerName:s.name})]}):(0,t.jsx)(b,{currentUserId:e,onSelectPartner:(e,r)=>{n({id:e,name:r||`User ${e}`})}})},_=e=>{let{title:r}=e;return(0,t.jsxs)("div",{style:{padding:"20px",textAlign:"center"},children:[(0,t.jsx)("h1",{children:r}),(0,t.jsx)("p",{children:"Эта страница еще в разработке."}),(0,t.jsx)("a",{href:"/",children:"На главную (Логин)"})]})},C=()=>(0,t.jsx)(o.VK,{children:(0,t.jsxs)(o.Z5,{children:[(0,t.jsx)(o.AW,{path:"/login",element:(0,t.jsx)(m,{})}),(0,t.jsx)(o.AW,{path:"/register",element:(0,t.jsx)(j,{})}),(0,t.jsx)(o.AW,{path:"/",element:(0,t.jsx)(S,{})}),(0,t.jsx)(o.AW,{path:"*",element:(0,t.jsx)(_,{title:"404 - Страница не найдена"})})]})}),w=document.getElementById("root");w&&n.createRoot(w).render((0,t.jsx)(a.StrictMode,{children:(0,t.jsx)(()=>(0,t.jsx)(C,{}),{})}))}},r={};function s(t){var a=r[t];if(void 0!==a)return a.exports;var n=r[t]={exports:{}};return e[t](n,n.exports,s),n.exports}s.m=e,s.d=(e,r)=>{for(var t in r)s.o(r,t)&&!s.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},s.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];s.O=(r,t,a,n)=>{if(t){n=n||0;for(var o=e.length;o>0&&e[o-1][2]>n;o--)e[o]=e[o-1];e[o]=[t,a,n];return}for(var l=1/0,o=0;o<e.length;o++){for(var[t,a,n]=e[o],i=!0,c=0;c<t.length;c++)(!1&n||l>=n)&&Object.keys(s.O).every(e=>s.O[e](t[c]))?t.splice(c--,1):(i=!1,n<l&&(l=n));if(i){e.splice(o--,1);var d=a();void 0!==d&&(r=d)}}return r}})(),s.rv=()=>"1.3.12",(()=>{var e={980:0};s.O.j=r=>0===e[r];var r=(r,t)=>{var a,n,[o,l,i]=t,c=0;if(o.some(r=>0!==e[r])){for(a in l)s.o(l,a)&&(s.m[a]=l[a]);if(i)var d=i(s)}for(r&&r(t);c<o.length;c++)n=o[c],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(d)},t=self.webpackChunkcommutator=self.webpackChunkcommutator||[];t.forEach(r.bind(null,0)),t.push=r.bind(null,t.push.bind(t))})(),s.ruid="bundler=rspack@1.3.12";var t=s.O(void 0,["72","361","118","664"],function(){return s(660)});t=s.O(t)})();